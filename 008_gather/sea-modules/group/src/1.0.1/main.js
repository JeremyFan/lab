define("group/src/1.0.1/main",["backbone","underscore","./routers/router","./views/app-view","./views/list-view","./templates/templates-module","./templates/templates.html","./collections/topic-collection","./models/topic-model","./views/topic-view","./views/group-head-view","./models/group-model","./views/new-topic-view","iscroll","./views/detail-view"],function(a){var b=a("backbone");window._=a("underscore");var c=a("./routers/router");window.app=new c,window.groupInfo=window.group_info,window.groupList=window.resultGroup,b.history.start()}),define("group/src/1.0.1/routers/router",["backbone","group/src/1.0.1/views/app-view","group/src/1.0.1/views/list-view","group/src/1.0.1/templates/templates-module","group/src/1.0.1/collections/topic-collection","group/src/1.0.1/models/topic-model","group/src/1.0.1/views/topic-view","group/src/1.0.1/views/group-head-view","group/src/1.0.1/models/group-model","group/src/1.0.1/views/new-topic-view","iscroll","group/src/1.0.1/views/detail-view"],function(a,b,c){var d=a("backbone"),e=a("group/src/1.0.1/views/app-view"),f=(a("group/src/1.0.1/views/list-view"),a("group/src/1.0.1/views/detail-view")),g=d.Router.extend({routes:{"":"initGroup","detail/:Id":"initTopicDetail"},initialize:function(){},initGroup:function(){this.appView=new e},initTopicDetail:function(a){var b=new f;b.showDetail(a)}});c.exports=g}),define("group/src/1.0.1/views/app-view",["backbone","group/src/1.0.1/views/list-view","group/src/1.0.1/templates/templates-module","group/src/1.0.1/collections/topic-collection","group/src/1.0.1/models/topic-model","group/src/1.0.1/views/topic-view","group/src/1.0.1/views/group-head-view","group/src/1.0.1/models/group-model","group/src/1.0.1/views/new-topic-view","iscroll"],function(a,b,c){var d=a("backbone"),e=a("group/src/1.0.1/views/list-view"),f=a("group/src/1.0.1/views/group-head-view"),g=a("iscroll"),h=d.View.extend({el:"body",events:{"tap .btn-more":"loadMore"},initialize:function(){this.initGroupList()},render:function(){},initGroupList:function(){var a=new f;this.$el.append(a.render()),this.listView=new e;var b=$("<div></div>"),c=$('<div class="group-bd"></div>'),d=$('<div class="scroll-wrapper" id="group-scroll-wrapper"></div>');b.append(this.listView.render()),b.append('<div class="group-ft btn-more">点击加载更多</div>'),d.append(b),c.append(d),this.$el.append(c),this.iScroll=new g("#group-scroll-wrapper",{mouseWheel:!0})},loadMore:function(){$(".btn-more").hasClass("disable")||(this.setBtnMoreLoading(),this.listView.loadMore(),this.iScroll.refresh())},setBtnMoreNoMore:function(){$(".btn-more").removeClass("loading").addClass("disable").html("没有更多帖子了")},setBtnMoreLoading:function(){$(".btn-more").html("").addClass("loading")},setBtnMoreNormal:function(){$(".btn-more").html("点击加载更多").removeClass("loading")}});c.exports=h}),define("group/src/1.0.1/views/list-view",["backbone","group/src/1.0.1/templates/templates-module","group/src/1.0.1/collections/topic-collection","group/src/1.0.1/models/topic-model","group/src/1.0.1/views/topic-view"],function(a,b,c){var d=a("backbone"),e=(a("group/src/1.0.1/templates/templates-module"),a("group/src/1.0.1/collections/topic-collection")),f=a("group/src/1.0.1/views/topic-view"),g=d.View.extend({templateId:"template-list",tagName:"section",className:"sec-topiclist",initialize:function(){this.topiclist=new e,this.listenTo(this.topiclist,"add",this.addOne),this.listenTo(this.topiclist,"reset",this.addAll),this.topiclist.fill(),window.topiclist=this.topiclist},render:function(){return this.$el},addOne:function(a){var b=new f({model:a});this.$el.append(b.render())},addAll:function(){this.$el.html(""),this.topiclist.each(this.addOne,this)},loadMore:function(){this.topiclist.getMoreTopicData()}});c.exports=g}),define("group/src/1.0.1/templates/templates-module",[],function(a,b,c){var d=a("group/src/1.0.1/templates/templates.html");_.templateSettings={interpolate:/\{\{=(.+?)\}\}/g,evaluate:/\{\{(.+?)\}\}/g};var e={registerTemplate:function(a,b){this[a]=_.template(b())}};!function(a){a.registerTemplate("test/test",function(){return"hello: {{= name }}"}),a.registerTemplate("nav/item",function(){var a="{{= linkAddress}}";return a});var b=$("<div>").html(d).children();b.each(function(){var b=$(this);a.registerTemplate(this.id,function(){return b.html()})})}(e),c.exports=e}),define("group/src/1.0.1/templates/templates.html",[],'<!-- 页面框架 -->\n<script type="text/template" id="template-page">\n    <header>header</header>\n    <div></div>\n</script>\n\n<!-- 聊吧信息 -->\n<script type="text/template" id="template-group-head">\n  <img src="{{=SmallLogo}}" alt="">\n  <div class="content">\n    <h3>{{=Name}}</h3>\n    <div class="info">\n      <span class="count-members">{{=UserCount}}</span> 成员\n      <span class="count-topics">{{=TotalCount}}</span> 帖子\n      <button class="btn-new" type="button">发新帖</button>\n    </div>\n  </div>\n</script>\n\n<!-- 帖子 -->\n<script type="text/template" id="template-topic">\n  <h3 class="title">{{=Title}}</h3>\n  <p class="content">{{=Summary}}</p>\n  <div class="info">\n    <span class="user">{{=nickname}}</span>\n    <span class="time">{{=Offset}}</span>\n    <span class="comments">{{=ReplyCount}}</span>\n  </div>\n</script>\n\n<!-- 帖子详情 -->\n<script type="text/template" id="template-detail">\n  <header class="page-hd">\n    <h3>帖子详情</h3>\n    <button class="btn-back" type="button"></button>\n  </header>\n  <div class="detail-bd">\n    <div class="scroll-wrapper" id="detail-scroll-wrapper">\n      <div>\n      <div class="detail-head">\n        <h3 class="title">{{=Title}}</h3>\n        <div class="user">{{=nickname}}</div>\n        <div class="info">\n          创建于:<span class="time">{{=Offset}}</span>\n        </div>       \n      </div>\n\n      <div class="content">\n        {{=Content}}\n      </div>\n      </div>\n    </div>\n  </div>\n</script>\n\n<!-- 发新帖 -->\n<script type="text/template" id="template-newtopic">\n  <header class="page-hd">发新帖\n    <button class="btn-back" type="button"></button>\n  </header>\n    <div class="nt-container">\n      <div class="nt-container-c">\n        <div class="nt-title-wrap">\n          <input type="text" class="nt-title" placeholder="标题">\n        </div>\n        <div class="nt-content-wrap">\n          <textarea class="nt-content" placeholder="内容"></textarea>\n        </div>\n      </div>\n    </div>\n  <footer class="page-ft">\n    <button type="button" class="btn-publish"></button>\n  </footer>\n</script>'),define("group/src/1.0.1/collections/topic-collection",["backbone","group/src/1.0.1/models/topic-model"],function(a,b,c){var d=a("backbone"),e=a("group/src/1.0.1/models/topic-model"),f=d.Collection.extend({model:e,initialize:function(){this.pageCount=2},fill:function(a){var b,c,d=a||this.getTopicData(),f=[];for(c=0;c<d.length;c++)b=new e,b.set(d[c]),b.set("id",d[c].Id),f.push(b);this.set(f,{remove:!1}),window.app.appView&&window.app.appView.iScroll.refresh()},getTopicData:function(){if(window.groupList.length)return window.groupList;throw new Error("can not find topics")},getMoreTopicData:function(){var a=this,b={groupId:window.groupInfo.Id,page:this.pageCount,essenType:0};$.ajax({url:"/group/groupwap/topiclist",data:b,type:"post",dataType:"json",success:function(b){b.grouptopicList.length?(this.topiclist.fill(b.grouptopicList),window.app.appView.setBtnMoreNormal(),a.pageCount++):window.app.appView.setBtnMoreNoMore()},error:function(){}})}});c.exports=f}),define("group/src/1.0.1/models/topic-model",["backbone"],function(a,b,c){var d=a("backbone"),e=d.Model.extend({defaults:{}});c.exports=e}),define("group/src/1.0.1/views/topic-view",["backbone","group/src/1.0.1/templates/templates-module"],function(a,b,c){var d=a("backbone");Templates=a("group/src/1.0.1/templates/templates-module");var e=d.View.extend({templateId:"template-topic",tagName:"article",className:"topic",events:{tap:"detail"},render:function(){return this.$el.html(Templates[this.templateId].call(_,this.model.toJSON())),this.$el},detail:function(){window.app.navigate("/detail/"+this.model.get("Id"),{trigger:!0})}});c.exports=e}),define("group/src/1.0.1/views/group-head-view",["backbone","group/src/1.0.1/templates/templates-module","group/src/1.0.1/models/group-model","group/src/1.0.1/views/new-topic-view"],function(a,b,c){var d=a("backbone"),e=a("group/src/1.0.1/templates/templates-module"),f=a("group/src/1.0.1/models/group-model"),g=a("group/src/1.0.1/views/new-topic-view"),h=d.View.extend({templateId:"template-group-head",tagName:"header",className:"group-hd",events:{"tap .btn-new":"showNewTopic"},initialize:function(){this.model=new f},showNewTopic:function(){var a=new g;a.showNewTopic()},render:function(){return this.build(),this.$el.html(e[this.templateId].call(_,this.model.toJSON())),this.$el},build:function(){var a=this.getGroupInfo();a.SmallLogo=__resourceDomain+a.SmallLogo,a.MiddleLogo=__resourceDomain+a.MiddleLogo,this.model.set(a)},getGroupInfo:function(){if("undefined"!=typeof window.groupInfo)return window.groupInfo;throw new Error("can not find group.")}});c.exports=h}),define("group/src/1.0.1/models/group-model",["backbone"],function(a,b,c){var d=a("backbone"),e=d.Model.extend({defaults:{}});c.exports=e}),define("group/src/1.0.1/views/new-topic-view",["backbone","group/src/1.0.1/templates/templates-module"],function(a,b,c){var d=a("backbone");Templates=a("group/src/1.0.1/templates/templates-module");var e=d.View.extend({templateId:"template-newtopic",tagName:"section",className:"sec-newtopic",events:{"tap .btn-back":"hideNewTopic","tap .btn-publish":"publishTopic"},render:function(){var a=$("body");this.$el.html(Templates[this.templateId]),a.append(this.$el)},showNewTopic:function(){this.render(),this.$el.show()},hideNewTopic:function(){this.$el.remove()},publishTopic:function(){var a,b=this,c=this.$el.find(".nt-title").val(),d=this.$el.find(".nt-content").val();return"undefined"==typeof c||""==$.trim(c)?(b.showMessage("请输入标题"),void 0):"undefined"==typeof d||""==$.trim(d)?(b.showMessage("请输入正文"),void 0):(a={groupId:window.groupInfo.Id,title:c,content:d,isSensitive:0},$.ajax({url:"/group/groupwap/publishTopic",data:a,type:"post",dataType:"json",success:function(a){var c;if("undefined"!=typeof a)if(a.status)c="发布成功！",b.showMessage(c),b.hideNewTopic();else{switch(a.code){case 0:c="还正被封禁呢";break;case 1:c="发帖要先加入聊吧哦";break;case 2:c="发帖过快，休息一下吧~";break;case 3:c="发布失败，有高危词哦";break;case 4:case 5:case 6:c="网络开小差了，休息一下吧~";break;case 7:c="已入库，但有敏感词哦";break;case 8:c="发布失败，有敏感词哦";break;case 0:c="";break;default:c="网络开小差了，休息一下吧~"}b.showMessage(c)}},error:function(){}}),void 0)},showMessage:function(a){alert(a)}});c.exports=e}),define("group/src/1.0.1/views/detail-view",["backbone","group/src/1.0.1/templates/templates-module","group/src/1.0.1/models/topic-model","iscroll"],function(a,b,c){var d=a("backbone");Template=a("group/src/1.0.1/templates/templates-module"),TopicModel=a("group/src/1.0.1/models/topic-model"),IScroll=a("iscroll");var e=d.View.extend({templateId:"template-detail",tagName:"section",className:"sec-topicdetail",model:TopicModel,events:{"click .btn-back":"hideDetail"},initialize:function(){},showDetail:function(a){this.render(a),this.$el.show(),new IScroll("#detail-scroll-wrapper",{mouseWheel:!0})},hideDetail:function(){this.$el.remove(),window.app.navigate("",{trigger:!1})},render:function(a){var b=$("body");this.build(a),b.append(this.$el),this.$el.find("img").on("load",function(){$(window).resize()})},build:function(a){this.model=this.getTopicDetail(a),this.$el.html(Templates[this.templateId].call(_,this.model.attributes))},getTopicDetail:function(a){return window.topiclist.get(a)}});c.exports=e});
