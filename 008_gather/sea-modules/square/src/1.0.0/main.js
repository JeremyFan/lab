define("square/src/1.0.0/main",["backbone","underscore","./routers/router","./common/util","./common/phone-adapter","./routers/subscribe-and-publish","./views/topic-detail-view","./models/topic-beside-model","./models/topic-comment-model","./content/rich-helper","./templates/templates-module","./templates/templates.html","./collections/topic-comment-collection","./views/topic-comment-view","./views/report-topic-view","./views/floater-view","./collections/popup-collection","./views/share-friend-view","./views/content-view","./models/page-model","iscroll","./views/page-view","./views/top-bar-view","./views/message-view","./content/send-view","./content/rich-text-view","./content/face-expression-view","./views/app","./views/navi-view","./models/navi-model","./controls/topic-manager","./views/topic-view","./collections/topic-collection","./views/slide-view","./models/slide-model","localdb"],function(a){window.Backbone=a("backbone"),window._=a("underscore");var b={9999:{hotImg:[412309,412310,412311,412312]},10:{hotImg:[412313]},19:{hotImg:[412314]},1:{hotImg:[412315]},4:{hotImg:[412316]},2:{hotImg:[412317]},15:{hotImg:[412318]},78:{hotImg:[412319]},9:{hotImg:[412320]}};window.buriedPoint=function(a){seajs.log("buriedPoint: "+a);try{wa_regIdCount(a)}catch(b){seajs.log(b)}},window.transAndPoint=function(a,c){var d=b[a].hotImg[c];buriedPoint(d)};var c=a("./routers/router");window.squareApp=new c,Backbone.history.start()}),define("square/src/1.0.0/routers/router",["square/src/1.0.0/common/util","square/src/1.0.0/common/phone-adapter","square/src/1.0.0/routers/subscribe-and-publish","square/src/1.0.0/views/topic-detail-view","square/src/1.0.0/models/topic-beside-model","square/src/1.0.0/models/topic-comment-model","square/src/1.0.0/content/rich-helper","square/src/1.0.0/templates/templates-module","square/src/1.0.0/collections/topic-comment-collection","square/src/1.0.0/views/topic-comment-view","square/src/1.0.0/views/report-topic-view","square/src/1.0.0/views/floater-view","square/src/1.0.0/collections/popup-collection","square/src/1.0.0/views/share-friend-view","square/src/1.0.0/views/content-view","square/src/1.0.0/models/page-model","iscroll","square/src/1.0.0/views/page-view","square/src/1.0.0/views/top-bar-view","square/src/1.0.0/views/message-view","square/src/1.0.0/content/send-view","square/src/1.0.0/content/rich-text-view","square/src/1.0.0/content/face-expression-view","square/src/1.0.0/views/app","square/src/1.0.0/views/navi-view","square/src/1.0.0/models/navi-model","square/src/1.0.0/controls/topic-manager","square/src/1.0.0/views/topic-view","square/src/1.0.0/collections/topic-collection","square/src/1.0.0/views/slide-view","square/src/1.0.0/models/slide-model","localdb"],function(a,b,c){var d=a("square/src/1.0.0/common/util"),e=a("square/src/1.0.0/routers/subscribe-and-publish"),f=a("square/src/1.0.0/views/topic-detail-view"),g=a("square/src/1.0.0/views/page-view"),h=a("square/src/1.0.0/common/phone-adapter"),i=a("square/src/1.0.0/views/message-view"),j=a("square/src/1.0.0/collections/popup-collection"),k=Backbone.Router.extend({routes:{"":"enterSquareMain",message:"enterMessage","topicDetail/:type/:topicId":"enterTopicDetail"},squarePages:[],initialize:function(){if(_.bindAll(this,"back"),window.squareMain=void 0,window.squareDetail=void 0,window.sendView=a("square/src/1.0.0/content/send-view"),location.search.indexOf("console")>-1){console.log=function(a){$("#test").append("<br/>"+a)};var b=$('<div id="logContainer" style="left: 5px; top: 80px;z-index: 100005; height: 60%; width: 95%;border: 1px solid red; background-color: white;position: absolute;">');b.append('<div id="test" style="height: 100%; width: 100%; overflow: auto;">'),b.append('<button id="logClear" style="position: absolute; top:5px; right: 5px;">clear</button>'),$("#logClear").live("click",function(){$("#test").html("")}),$(document.body).append(b)}$("#appContainer").append($('<div id="mainPage" class="animate-page">')),$("#appContainer").append($('<div id="topicDetailContainer" style="display: none;" class="animate-page">')),$("#appContainer").append($('<div id="messageContainer" style="display: none;" class="animate-page">')),e.subscribe("NAV_BACK",this.back),h.registerCallback({back:function(){e.publish("NAV_BACK")}}),$(window).resize(this.adjustFrame),d.validateLogin(),console.log("$('#appContainer') height:"+$("#appContainer").height())},enterSquareMain:function(){var b=a("square/src/1.0.0/views/app");window.squareMain=new b;var c=this.openPage({wrapper:$("#appContainer #mainPage"),topBar:{title:"内容广场",menuBtnType:0,menuCallback:function(){squareApp.navigate("/message",{trigger:!0})}}});squareMain.page=c,squareMain.$el=c.contentWrapper,c.targetView=squareMain,squareMain.initDataFromServer(),h.registerCallback({message:function(a){console.log("received data :"+a)}})},enterTopicDetail:function(a,b){if(a=+a,squareDetail)this.openPage({page:squareDetail.page});else{$("#appContainer #topicDetailContainer").append($('<div class="topic-detail-page">'));var c=$("#appContainer #topicDetailContainer .topic-detail-page");window.squareDetail=new f;var e=this.openPage({wrapper:c,topBar:{title:"话题详情",menuBtnType:d.isNewVersion?2:0,menuItems:[{value:"shareToFriend",text:"分享到朋友圈"},{value:"shareToGroup",text:"分享到群动态"},{value:"shareToMessage",text:"分享到飞信消息"},{value:"report",text:"举报"},{value:"cancel",text:"取消"}]}});squareDetail.page=e,e.targetView=squareDetail,squareDetail.$el=e.contentWrapper,d.isNewVersion&&(sendView.broadcastDiv=c,sendView.show(),sendView.registerEvents({sendComment:squareDetail.sendComment}))}a=d.isNewVersion?a:1,squareDetail.show({type:a,topicId:b})},enterMessage:function(){console.log("message"),$("#appContainer #messageContainer").append($('<div class="messagePage">'));var a=this.openPage({wrapper:$("#appContainer #messageContainer .messagePage"),topBar:{title:"消息列表",menuBtnType:0,menuCallback:function(){return!1}}});i.page=a,i.$el=a.contentWrapper,i.render()},adjustFrame:function(){console.log("router adjustFrame invoked~"),squareApp.squarePages.length&&_.last(squareApp.squarePages).refresh()},openPage:function(a){if(this.squarePages.length){var b=_.last(this.squarePages);b.hideToLeft()}else h.hideWebTitle();var c=a.page?a.page:new g({model:a.model||{},wrapper:a.wrapper,loadMoreCallback:a.loadMoreCallback,topBar:a.topBar||{}});return this.squarePages.length?c.showFromRight():c.show(),this.squarePages.push(c),c.locationHash=Backbone.history.fragment,c},back:function(){if(j.length)j.pop();else{var a=this.squarePages.pop();this.squarePages.length?(a.hideToRight(),a=_.last(this.squarePages),a.showFromLeft()):h.destroyWebview(),squareApp.navigate(a.locationHash,{trigger:!1})}return!1}});c.exports=k}),define("square/src/1.0.0/common/util",["square/src/1.0.0/common/phone-adapter"],function(a,b,c){var d="/group/beside/";a("square/src/1.0.0/common/phone-adapter");var e={topicType:{group:1,page:2},nativeVersion:0,isNewVersion:!1,getAjaxCommonParam:function(){var a={};return a},getUrl:function(a,b){var c="";switch(a){case"transCkey":c="",c=b?"http://192.168.251.19:8080":"http://221.176.31.206",c+="/mbeside/person/convertckey";break;case"login":c=d+"toLogin";break;case"loadCatalog":c="getBesideTypes";break;case"hotImage":c=d+"getRegionImageByTypeId?typeId=9999";break;case"topTopic":c=d+"getBesideTopTopicListByType";break;case"topicList":c=d+"getBesideTopicListByType";break;case"shareTopic":c=d+"publishBesideFeed";break;case"topicDetail":c=d,b==e.topicType.group?c+="getTopicDetail":b==e.topicType.page&&(c+="getElementDetail");break;case"reportTopic":b==e.topicType.group?c="/report/reportGroup":b==e.topicType.page&&(c="/report/reportPage");break;case"deleteTopic":b==e.topicType.group?c="group/topic/deleteTopic?userId=200098670&topicId=148880&groupId=6739&feedId=z4izv3tgpiy57&hideFeedId=y4iz5zsgpiy57&isTop=0&isEssence=0":b==e.topicType.page&&(c="pages/detail/e_delete?ElementID=1322570983&feedid=53izz9qmijx57&pageid=16602&userid=200098670&UserFeedID=63izmeqmijx57");break;case"topicComments":c=d,b==e.topicType.group?c+="getTopicComment":b==e.topicType.page&&(c+="fetchPageComment");break;case"commentTopic":b==e.topicType.group?c="/group/beside/publishReplyformobile":b==e.topicType.page&&(c=d+"addElementComment");break;case"deleteComment":c=d,b==e.topicType.group?c+="deleteTopicComment?Id=860309":b==e.topicType.page&&(c+="deleteElementComment?ElementID=1322570977&commentId=778&CommentCount=100")}return c},intervalCounter:0,filterHtmlString:function(a){return a},toast:function(a){var b="toast-popup",c=$("<div>");c.addClass(b).append($("<span>").text(a)),$(document.body).append(c),c.fadeIn(800,function(){setTimeout(function(){c.fadeOut(800,function(){c.remove()})},1500)})},reportTopic:function(a,b){b=b||{},$.ajax({url:e.getUrl("reportTopic",b.type),type:"post",data:a,dataType:"json"}).done(function(){console.log("success"),e.toast("举报成功"),b.done&&b.done()}).fail(function(){console.log("fail"),e.toast("举报失败"),b.fail&&b.fail()})},validateLogin:function(){var a=!(!window.__islogin&&!window.__isLogin&&(window.PROFILE_DATA?!window.PROFILE_DATA.profile:1)),b=window.__version||"3.2.0",c=window.__ckey||"";console.log(c),b=+b.replace(/\./g,""),e.nativeVersion=b,e.isNewVersion=b>320,a||e.transCkey(c)},phpLogin:function(a){console.log("login invoked with ckey: "+a);var b={c:a};$.ajax({type:"POST",url:e.getUrl("login"),dataType:"json",data:b}).done(function(a){a||e.toast("登录失败"),window.__islogin=a})},transCkey:function(a){var b=+window.__resourceVersion||1,c=function(a){if(200==a.status){var b=encodeURIComponent(a.data[0].c);b=b.substr(0,b.length-3),e.phpLogin(b)}else e.isNewVersion&&e.toast("登录失败")};e.isNewVersion?e.phpLogin(a):$.ajax({type:"POST",url:e.getUrl("transCkey",1==b)+"?ckey="+a,dataType:"jsonp",success:c})}};c.exports=e}),define("square/src/1.0.0/common/phone-adapter",[],function(a,b,c){window.JSCallbacker={};var d={callFunc:function(a,b,c){try{if($.os.ios){var d={type:a,param:b,position:c};window.location.href=encodeURI("square:"+JSON.stringify(d))}else{console.log(a+" invoked"),b=b?JSON.stringify(b):"";var e=window.AdapterObject;switch(a){case"destroyWebview":e.destroyWebview();break;case"hideWebTitle":e.hideWebTitle();break;case"clearMessageState":e.clearMessageState();break;case"shareToGroup":e.shareToGroup(b);break;case"shareToMessage":e.shareToMessage(b);break;case"report":e.report(b);break;case"viewAttachment":e.viewAttachment(b,c);break;case"openUrl":e.openUrl(b)}}}catch(f){console.log(f)}},getCredential:function(){return"dWlkZmlkbG9naWNwb29sPTIwMDMwNzMyOT0xMDUwMDE2Nzg4PTY5MTc="},destroyWebview:function(){d.callFunc("destroyWebview","")},clearMessageState:function(){d.callFunc("clearMessageState","")},hideWebTitle:function(){d.callFunc("hideWebTitle","")},shareToGroup:function(a){d.callFunc("shareToGroup",a)},shareToMessage:function(a){d.callFunc("shareToMessage",a)},report:function(a){d.callFunc("report",a)},openUrl:function(a){d.callFunc("openUrl",a)},viewAttachment:function(a,b){d.callFunc("viewAttachment",a,b)},registerCallback:function(a){console.log("registerCallback invoked"),$.extend(JSCallbacker,a)}};c.exports=d}),define("square/src/1.0.0/routers/subscribe-and-publish",[],function(a,b,c){var d={};!function(a){var b={},c=-1;a.publish=function(a,c){return b[a]?(setTimeout(function(){for(var d=b[a],e=d?d.length:0;e--;)d[e].func(a,c)},0),void 0):!1},a.subscribe=function(a,d){b[a]||(b[a]=[]);var e=(++c).toString();return b[a].push({token:e,func:d}),e},a.subscribeOnce=function(a,d){b[a]||(b[a]=[]);var e=(++c).toString();return b[a][0]={token:e,func:d},e},a.unsubscribe=function(a){for(var c in b)if(b[c])for(var d=0,e=b[c].length;e>d;d++)if(b[c][d].token===a)return b[c].splice(d,1),a;return!1}}(d),c.exports=d}),define("square/src/1.0.0/views/topic-detail-view",["square/src/1.0.0/models/topic-beside-model","square/src/1.0.0/models/topic-comment-model","square/src/1.0.0/content/rich-helper","square/src/1.0.0/templates/templates-module","square/src/1.0.0/routers/subscribe-and-publish","square/src/1.0.0/common/phone-adapter","square/src/1.0.0/common/util","square/src/1.0.0/collections/topic-comment-collection","square/src/1.0.0/views/topic-comment-view","square/src/1.0.0/views/report-topic-view","square/src/1.0.0/views/floater-view","square/src/1.0.0/collections/popup-collection","square/src/1.0.0/views/share-friend-view","square/src/1.0.0/views/content-view","square/src/1.0.0/models/page-model","iscroll"],function(a,b,c){var d=a("square/src/1.0.0/models/topic-beside-model"),e=a("square/src/1.0.0/models/topic-comment-model"),f=a("square/src/1.0.0/templates/templates-module"),g=a("square/src/1.0.0/routers/subscribe-and-publish"),h=a("square/src/1.0.0/common/phone-adapter"),i=a("square/src/1.0.0/common/util"),j=a("square/src/1.0.0/collections/topic-comment-collection"),k=a("square/src/1.0.0/views/topic-comment-view"),l=a("square/src/1.0.0/views/share-friend-view"),m=a("square/src/1.0.0/views/report-topic-view"),n=a("square/src/1.0.0/views/content-view"),o=Backbone.View.extend({templateId:"topicDetailTpl",subscribeTokens:[],commentContainer:null,initialized:!1,events:{"tap .imglist img":"viewImage","tap .bottom-comment-default":"showCommentView"},initialize:function(){_.bindAll(this,"addOneComment","loadMore","sendComment"),this.model=new d,this.listenTo(this.model,"change",function(){this.commentList=null,this.render()})},render:function(){var a=$(f[this.templateId].call(_,this.model.attributes));this.wrapper.empty().append(a.filter(".post"),a.filter(".comment-container")),0===this.$el.next(".bottom-comment-default").length&&this.$el.append(a.filter(".bottom-comment-default")),this.initialized||(this.bindTopMenu(),this.contentView.init(),this.initialized=!0),this.getComments(),this.$(".imglist img").each(function(a,b){b.onload=function(){$(window).resize(),console.log("topicDetail img load completed~")},$(b).attr("src",$(b).attr("data-url")).get(0)}),this.delegateEvents(),this.refresh()},show:function(a){if(!this.initialized){var b=new n({wrapper:this.$el,loadMoreCallback:this.loadMore,isOldDetail:!i.isNewVersion});this.wrapper=b.contentWrapper,this.contentView=b}sendView.reset(),this.loadDetail(a.type,a.topicId)},refresh:function(){this.contentView.adjustFrame()},bindTopMenu:function(){var a=this,b=this.page.options.topBar.menuItems;_.each(b,function(b){var c=g.subscribe("topBar_"+b.value,function(){a[b.value].call(a)});a.subscribeTokens.push(c)})},shareToFriend:function(){console.log("shareToFriend"),l.model.set(this.model.attributes),l.$el.is(":hidden")&&l.render()},shareToGroup:function(){h.shareToGroup(this.model.attributes),console.log("shareToGroup")},shareToMessage:function(){h.shareToMessage(this.model.attributes),console.log("shareToMessage")},viewImage:function(a){var b=$(a.target);b=b.is("img")?b.parent():b,console.log("position: "+b.index()),h.viewAttachment(this.model.attributes,b.index()),console.log("viewImage")},report:function(){var a=this;m.show(),m.reportOK=function(b){var c={type:b.type,reason:b.reason,elementId:a.model.get("id")};a.model.get("type")==i.topicType.group&&(c.elementType=6);var d={type:a.model.get("type"),done:function(){b.callback()}};i.reportTopic(c,d)}},cancel:function(){console.log("cancel")},loadDetail:function(a,b,c){c=c||{};var d,e=this;if(!c.refresh&&squareMain&&(d=squareMain.currentTopicManager.collection.findWhere({type:a,id:b})))return e.model.set(d.attributes),e.refresh(),e.contentView.resetScrollPos({x:0,y:0}),void 0;if(!d){var f={type:0,topicId:b};$.extend(f,i.getAjaxCommonParam()),$.ajax({url:i.getUrl("topicDetail",a),type:"POST",dataType:"json",data:f}).done(function(b){var d=e.model.parseData(b);d.type=a,e.model.set(d),c.callback&&c.callback()}).fail(function(){console.log("error"),i.toast("加载失败")})}},getComments:function(){var a=this.commentList;if(!a){var b={};b.type=this.model.get("type"),b.topicId=this.model.get("id"),b.feedId=this.model.get("feedId"),a=new j([],b),this.listenTo(a,"reset",this.addAllComment),this.listenTo(a,"add",this.addOneComment),this.listenTo(a,"remove",this.removeComment),this.commentList=a}this.commentContainer=this.$(".comment-container"),a.initData()},sendComment:function(a){if(i.toast("正在发送"),!this.loading){this.loading=!0;var b=this;console.log(a.content);var c,d=+this.model.get("type");switch(d){case i.topicType.group:c={groupId:this.model.get("groupId"),topicId:this.model.get("id"),topicUserId:PROFILE_DATA.profile.userId,isToFeed:a.isToFeed,feedId:this.model.get("feedId"),content:a.content};break;case i.topicType.page:c={elementID:this.model.get("id"),total:3,content:a.content,isToFeed:a.isToFeed}}$.ajax({url:i.getUrl("commentTopic",d),type:"post",data:c,dataType:"json"}).done(function(a){a.status?(console.log("success"),i.toast("评论成功"),sendView.hideFloater(),b.commentSuccess(a)):(console.log("fail"),i.toast("评论失败"))}).fail(function(){console.log("fail"),i.toast("评论失败")}).always(function(){b.loading=!1})}},commentSuccess:function(a){var b=new e,c={Id:a.replyId,CreatedDateTime:a.CreateDateTime,TopicId:a.TopicID,Content:a.Data.Content,UserId:a.UserInfo.userId,nickname:a.UserInfo.nickname,portrait:a.UserInfo.portraitTiny};c=b.parseData(c),c.isNewVersion=i.isNewVersion,b.set(c),this.commentList.add(b),$(window).resize()},loadMore:function(a){console.log("刷新回调:"+a.loadType);var b={callback:a.complete};a.loadType?this.commentList.getMoreData(b):(b.refresh=!0,this.loadDetail(this.model.get("type"),this.model.get("id"),b))},addAllComment:function(){this.commentList.each(this.addOneComment),$(window).resize()},addOneComment:function(a){var b=new k({model:a});this.commentContainer.append(b.render())},removeComment:function(){console.log("删除评论~")},showCommentView:function(){window.sendView.showBottomComment()}});c.exports=o}),define("square/src/1.0.0/models/topic-beside-model",[],function(a,b,c){var d=Backbone.Model.extend({defaults:{id:0,userid:0,groupId:0,title:"正在加载",content:"正在加载",portraituri:"",browsers:0,comments:0,time:0,markerid:0,ishot:0,vest:0,sGroupId:0,type:0,feedId:0,userFeedId:0,videos:[],images:[],voices:[],typeId:0,timeStr:"",errorImage:__resourceDomain+"/img/app/webunite/squareapp/XM_topic_icon.png",subContent:"",page:""},parseData:function(a){var b={id:a.Id||a.ElementID||0,userid:a.UserId||0,groupId:a.GroupId||a.PageID||0,page:a.GroupId||a.PageID||0,content:a.Content||a.TextContent||"",portraituri:"",title:a.Title||"",browsers:a.ReadCount||0,comments:a.ReplyCount||a.CommantCount||0,time:Date.parse(a.CreatedDateTime)||0,markerid:a.markerid||0,ishot:a.sIsHot||0,vest:a.sIsVerst||0,sGroupId:a.sGroupId||a.ElementType||0,type:a.DataType||0,feedId:a.FeedID||a.FeedId||0,userFeedId:a.UserFeedID||0,attachment:a.attachment||[],images:[],videos:[],audios:[],timeStr:a.CreatedDateTime||"",subContent:""};return b.subContent=b.content.replace(/<img [^>]*src=['"]([^'"]+)[^>]*>/gi,"").substr(0,50),a.hasOwnProperty("PicUrl")&&a.PicUrl.length&&!a.attachment.length?this.parsePicUrl(b,a.PicUrl):this.parseAttachment(b,a.attachment||[]),b.portraituri=b.images.length?b.images[0].thumburi_s:this.get("errorImage"),b},parsePicUrl:function(a,b){var c=b.split("");for(var d in c)a.images.push({thumburi_s:c[d],thumburi_m:c[d],datauri:c[d],type:1})},parseAttachment:function(a,b){for(var c in b){var d={datauri:"视频的URI",thumburi_s:"较小尺寸缩略图URI",thumburi_m:"较大尺寸缩略图URI",type:2},e=b[c].thumburi.split(",");switch(d.thumburi_s=e[0],d.thumburi_m=e[1],d.datauri=b[c].datauri||e[1],d.type=b[c].type,+b[c].type){case 1:a.images.push(d);break;case 2:a.videos.push(d);break;case 3:a.voices.push(d)}}}});c.exports=d}),define("square/src/1.0.0/models/topic-comment-model",["square/src/1.0.0/content/rich-helper"],function(a,b,c){var d=a("square/src/1.0.0/content/rich-helper"),e=Backbone.Model.extend({idAttribute:"commentId",defaults:{commentId:"",content:"",downCount:0,feedId:"",id:0,isWhisper:0,ownerId:0,parentCommentId:0,parentId:0,poiId:0,publishTime:"",screenName:"",sourceId:0,upCount:0,userId:0,userName:"",userPortrait:"",userUrl:"",timeStr:""},parseData:function(a){var b={commentId:a.commentId||a.Id||"",content:a.content||a.Content||"",feedId:a.feedId||"",id:a.id||0,ownerId:a.ownerId||0,parentCommentId:a.parentCommentId||0,parentId:a.parentId||0,publishTime:a.publishTime||"",nickName:a.screenName||a.nickname?a.screenName||a.nickname:a.userName||"",userId:a.userId||0,userPortrait:__resourceDomain+(a.userPortrait||a.portrait||""),timeStr:a.CreatedDateTime||""};return b.content=d.filterContentExpression(b.content),b}});c.exports=e}),define("square/src/1.0.0/content/rich-helper",[],function(a,b,c){var d={filterEnter:function(a){return a?a.replace(/\n/g,"<br/>"):""},filterContentExpression:function(a){var b=!0;if(!a)return"";a=d.filterEnter(a);var c=__resourceDomain+"/img/app/webunite/phiz/";c+=b?"new_expression/":"layer/";var e=b?".png":".gif",f={"[/微笑]":"1"+e,"[/大笑]":"2"+e,"[/眨眼]":"3"+e,"[/桃心]":"4"+e,"[/害羞]":"5"+e,"[/惊讶]":"6"+e,"[/疑问]":"7"+e,"[/天真]":"8"+e,"[/鬼脸]":"9"+e,"[/囧]":"10"+e,"[/悲伤]":"11"+e,"[/白眼]":"12"+e,"[/坏笑]":"13"+e,"[/流泪]":"14"+e,"[/拍砖]":"15"+e,"[/尴尬]":"16"+e,"[/鄙视]":"17"+e,"[/给力]":"18"+e,"[/挖鼻孔]":"19"+e,"[/晕]":"20"+e,"[/切]":"21"+e,"[/睡觉]":"22"+e,"[/鼓掌]":"23"+e,"[/嘘]":"24"+e,"[/痛恨]":"25"+e,"[/忐忑]":"26"+e,"[/失望]":"27"+e,"[/困惑]":"28"+e,"[/担心]":"29"+e,"[/纠结]":"30"+e,"[/思考]":"31"+e,"[/窃喜]":"32"+e,"[/得意]":"33"+e,"[/呆子]":"34"+e,"[/闭嘴]":"35"+e,"[/汗]":"36"+e,"[/吐]":"37"+e,"[/惊恐]":"38"+e,"[/亲亲]":"39"+e,"[/胜利]":"40"+e,"[/痛扁]":"41"+e,"[/吃饭]":"42"+e,"[/赞]":"43"+e,"[/喷血]":"44"+e,"[/再见]":"45"+e,"[/生病]":"46"+e,"[/拥抱]":"47"+e,"[/无聊]":"48"+e,"[/灵感]":"49"+e,"[/赞同]":"50"+e,"[/愤怒]":"51"+e,"[/抓狂]":"52"+e,"[/爱心]":"53"+e,"[/心碎]":"54"+e,"[/菜刀]":"55"+e,"[/OK]":"56"+e,"[/强]":"57"+e,"[/弱]":"58"+e,"[/便便]":"59"+e,"[/礼物]":"60"+e,"[/蛋糕]":"61"+e,"[/钱]":"62"+e,"[/天使]":"63"+e,"[/恶魔]":"64"+e,"[/示爱]":"new_expression_frame_048.png","[/玫瑰]":"new_expression_frame_054.png","[/凋谢]":"new_expression_frame_055.png","[/猪头]":"new_expression_frame_056.png","[/咖啡]":"new_expression_frame_062.png","[/Hold]":"new_expression_frame_070.png","[/足球]":"new_expression_frame_071.png","[/看电视]":"new_expression_frame_072.png","[/棒棒糖]":"new_expression_frame_073.png","[/萌猫]":"new_expression_frame_074.png","[/顶]":"new_expression_frame_075.png","[/骷髅]":"new_expression_frame_076.png"},g={"[/微笑]":"微笑","[/大笑]":"大笑","[/眨眼]":"眨眼","[/桃心]":"桃心","[/害羞]":"害羞","[/惊讶]":"惊讶","[/疑问]":"疑问","[/天真]":"天真","[/鬼脸]":"鬼脸","[/悲伤]":"悲伤","[/白眼]":"白眼","[/坏笑]":"坏笑","[/流泪]":"流泪","[/尴尬]":"尴尬","[/鄙视]":"鄙视","[/给力]":"给力","[/挖鼻孔]":"挖鼻孔","[/晕]":"晕","[/切]":"切","[/睡觉]":"睡觉","[/鼓掌]":"鼓掌","[/嘘]":"嘘","[/痛恨]":"痛恨","[/忐忑]":"忐忑","[/失望]":"失望","[/困惑]":"困惑","[/担心]":"担心","[/纠结]":"纠结","[/思考]":"思考","[/窃喜]":"窃喜","[/得意]":"得意","[/呆子]":"呆子","[/闭嘴]":"闭嘴","[/汗]":"汗","[/吐]":"吐","[/惊恐]":"惊恐","[/亲亲]":"亲亲","[/胜利]":"胜利","[/痛扁]":"痛扁","[/吃饭]":"吃饭","[/赞]":"赞","[/喷血]":"喷血","[/再见]":"再见","[/生病]":"生病","[/拥抱]":"拥抱","[/无聊]":"无聊","[/灵感]":"灵感","[/示爱]":"示爱","[/赞同]":"赞同","[/愤怒]":"愤怒","[/抓狂]":"抓狂","[/爱心]":"爱心","[/心碎]":"心碎","[/玫瑰]":"玫瑰","[/凋谢]":"凋谢","[/猪头]":"猪头","[/菜刀]":"菜刀","[/OK]":"OK","[/强]":"强","[/弱]":"弱","[/便便]":"便便","[/咖啡]":"咖啡","[/礼物]":"礼物","[/蛋糕]":"蛋糕","[/钱]":"钱","[/囧]":"囧","[/顶]":"顶","[/天使]":"天使","[/恶魔]":"恶魔","[/拍砖]":"拍砖","[/足球]":"足球","[/萌猫]":"萌猫","[/骷髅]":"骷髅","[/Hold]":"Hold","[/看电视]":"看电视","[/棒棒糖]":"棒棒糖"},h=/\[\/[\u4e00-\u9fa5]{1,4}]|\[\/Hold]|\[\/OK]/gim,i=a.match(h);if(i)for(var j=0;j<i.length;j++)f[i[j]]&&(a=a.replace(i[j],'<img title="'+g[i[j]]+'" src="'+c+f[i[j]]+'"  class="face-size" />'));return a}};c.exports=d}),define("square/src/1.0.0/templates/templates-module",[],function(a,b,c){var d=a("square/src/1.0.0/templates/templates.html");_.templateSettings={interpolate:/\{\{=(.+?)\}\}/g,evaluate:/\{\{(.+?)\}\}/g};var e={registerTemplate:function(a,b){this[a]=_.template(b())}};!function(a){a.registerTemplate("test/test",function(){return"hello: {{= name }}"}),a.registerTemplate("nav/item",function(){var a="{{= linkAddress}}";return a});var b=$("<div>").html(d).children();b.each(function(){var b=$(this);a.registerTemplate(this.id,function(){return b.html()})})}(e),c.exports=e}),define("square/src/1.0.0/templates/templates.html",[],'<!-- topbar -->\n<script type="text/template" id="topBarTpl">\n    <span class="h_left"></span>\n    <h2 class="title">{{=title}}</h2>\n    <div class="h_right">\n        {{ if(menuBtnType){ }}\n        <span class="menu_btn {{=menuClass}}"></span>\n        {{ if(menuItems && menuItems.length){ }}\n        <div class="top_menu">\n            <ul>\n                {{ for(var i=0; i < menuItems.length; i++){ }}\n                <li data-action="{{=menuItems[i].value}}">\n                    <span class="react">{{=menuItems[i].text}}</span>\n                </li>\n                {{ } }}\n            </ul>\n        </div>\n        {{ } }}\n        {{ } }}\n    </div>\n</script>\n\n<!-- 消息 -->\n<script type="text/template" id="messageTpl">\n    <section class="msg-list">\n        <article class="msg">\n            <img class="head" src="" alt="">\n            <div class="info">\n                <span class="name">马达加斯加</span>\n                <span class="time">15分钟前</span>\n                <p class="re-text">好啊。。那就。。。那就那就那就那就那就那就那就那就那就</p>\n                <p class="topic-text">我的话题：哦哦哦哦哦哦哦。。哦哦哦哦哦哦哦。。哦哦哦哦哦哦哦</p>\n            </div>\n        </article>\n    </section>\n</script>\n\n<!-- 页面框架 -->\n<script type="text/template" id="pageTpl">\n    <header class="page-header"></header>\n    <section class="content-container"></section>\n    <div class="nav_bar"></div>\n</script>\n<!-- 下拉刷新 -->\n<script type="text/template" id="contentTpl">\n    <div class="wrapper">\n        <div class="scroller">\n            <div class="load_top load_more">\n                <div id="load_top" class="touch">\n                    <i></i>\n                    <span class="touch_text">下拉刷新</span>\n                    <span class="start_text">松手刷新</span>\n                    <span class="loading_text">正在加载</span>\n                    <br>\n                    <!--<span class="last_refresh_time">上次更新于2014-9-2 18:45:36</span>-->\n                </div>\n            </div>\n            <div class="content_wrapper">\n            </div>\n            <div class="load_bottom load_more">\n                <div id="load_bottom" class="touch">\n                    <i></i>\n                    <span class="touch_text">上拉加载更多</span>\n                    <span class="start_text">松手加载更多</span>\n                    <span class="loading_text">正在加载</span>\n                </div>\n            </div>\n        </div>\n    </div>\n</script>\n\n<!-- 话题详情 -->\n<script type="text/template" id="topicDetailTpl">\n    <section class="post">\n        <h3 class="title">{{=title}}</h3>\n        <pre class="content">{{=content}}</pre>\n    </section>\n    <section class="comment-container">\n        <div class="cut">\n            <span class="text">大家都在说({{=comments}})</span>\n            <div class="line"></div>\n        </div>\n    </section>\n    <div class="bottom-comment-default active">\n        <div class="btn-comment-box">说点什么吧...</div>\n    </div>\n</script>\n\n<!-- 话题评论 -->\n<script type="text/template" id="topicCommentTpl">\n    <img class="head" src="{{=userPortrait}}" alt="">\n    <div class="info">\n        <span class="name">{{=nickName}}</span>\n        <span class="time">{{=timeStr}}</span>\n\n        <div class="content">\n            {{ if(isNewVersion && false){ }}\n            <div class="re">\n                <span class="show_more">···</span>\n\n                <div class="menu">\n                    <ul>\n                        <li class="report">举报</li>\n                    </ul>\n                </div>\n            </div>\n            {{ } }}\n            <div class="content-c">\n                <p class="text">{{=content}}</p>\n            </div>\n        </div>\n        <!--<div class="location">-->\n        <!--在 东极岛-->\n        <!--</div>-->\n    </div>\n</script>\n\n<!-- 分类目录 -->\n<script type="text/template" id="navTpl">\n    <div class="catalog_bar">\n        <ul class="catalog">\n            {{ for(var i=0; i < items.length; i++){ }}\n            <li class="{{ if(i==0){ }}active{{ } }}" data-id="{{=items[i].id}}" data-type="{{=items[i].Type}}"><span>{{=items[i].TypeName}}</span>\n            </li>\n            {{ } }}\n        </ul>\n    </div>\n</script>\n\n<!-- 滑动切换 -->\n<script type="text/template" id="slideTpl">\n    <div class="viewport">\n        <div class="imageWrapper">\n            <div class="imageScroller">\n                {{ for(var i=0; i < items.length; i++){ }}\n                <div class="slide">\n                    <img src="{{=items[i].img}}">\n\n                    <div class="content">\n                        {{=items[i].title}}\n                    </div>\n                </div>\n                {{ } }}\n            </div>\n        </div>\n    </div>\n    {{ if(items.length > 1) { }}\n    <div class="indicator">\n        <div class="dotty"></div>\n        <ul class="ind_ul">\n            <li></li>\n            <li></li>\n            <li></li>\n            <li></li>\n        </ul>\n    </div>\n    {{ } }}\n</script>\n\n<!-- 分类下的内容 -->\n<script type="text/template" id="tabContentTpl">\n    <section class="slider"></section>\n    <section class="topic_container"></section>\n</script>\n\n<!-- 列表项 -->\n<script type="text/template" id="topicTpl">\n    <img alt="" src="{{=portraituri}}">\n    <h3 class="title">{{=title}}</h3>\n    <p>{{=subContent}}</p>\n    <!--<span class="time">{{=timeStr}}</span>-->\n    <div class="info">\n        <span class="read">{{=browsers}}</span>\n        <span class="comm">{{=comments}}</span>\n    </div>\n</script>\n\n<!-- 评论 -->\n<script type="text/template" id="commentTpl">\n    <header class="cp-hd">\n        <button class="btn-close"></button>\n        评论\n        <button class="btn-pub">发布</button>\n    </header>\n    <section class="cp-content">\n        <textarea></textarea>\n    </section>\n    <footer class="cp-ft">\n        <div class="share">\n            分享到朋友圈\n        </div>\n        <div class="btn-wrap">\n            <button class="btn-pic"></button>\n            <button class="btn-exp"></button>\n        </div>\n    </footer>\n</script>\n\n<!-- 分享 -->\n<script type="text/template" id="shareTopicTpl">\n    <div class="sp_wrap">\n        <section class="sp_content">\n            <div class="content_wrap">\n                <img class="logo" src="{{=portraituri}}" alt="">\n                <h4 class="title">{{=title}}</h4>\n\n                <p class="text">{{=subContent}}</p>\n            </div>\n            <div class="comment_wrap">\n                <textarea id="shareContent" placeholder="说点什么..."></textarea>\n            </div>\n        </section>\n        <footer class="sp_ft">\n            <span class="btn_cancel">取消</span>\n            <span class="btn_sent">发送</span>\n        </footer>\n    </div>\n</script>\n\n<!--举报-->\n<script type="text/template" id="reportTopicTpl">\n    <div class="sp_wrap">\n        <section class="sp_content">\n            <div class="content_wrap">\n                <div class="extend-text">举报理由:</div>\n                <div class="reason-table">\n                    <label><input class="reason-radio" type="radio" value="7" name="reason"/>色情</label>\n                    <label><input class="reason-radio" type="radio" value="6" name="reason"/>政治</label>\n                    <label><input class="reason-radio" type="radio" value="8" name="reason"/>广告</label>\n                    <label><input class="reason-radio" type="radio" value="11" name="reason"/>其他</label>\n                </div>\n            </div>\n            <div class="comment_wrap">\n                <div class="extend-text">补充说明:</div>\n                <div><textarea class="reason-content" type=\'text\'/></div>\n            </div>\n        </section>\n        <footer class="sp_ft">\n            <span class="btn_cancel">取消</span>\n            <span class="btn_sent">举报</span>\n        </footer>\n    </div>\n</script>\n\n<!--暂时放这里-->\n<!-- 公用内容输入及调用表情 -->\n<script type="text/template" id="common-content-alone-template">\n    <div class="bc-header">\n        <h3 class="bc-title">评论</h3>\n    </div>\n    <div class="bc-body">\n        <div class="reply-textarea"></div>\n        <div class="more-wrap">\n            <span class="btn-expression"></span><span class="btn-picture"></span>\n            <div class="checkbox-wrapper">\n                <input type="checkbox" id="chkShare">\n                <label for="chkShare">同步到朋友圈</label>\n            </div>\n        </div>\n        <span class="btn-send">发送</span>\n    </div>\n</script>\n\n<!-- 公用内容输入及调用表情 -->\n<script type="text/template" id="common-text-template">\n    <div class="bottom-comment">\n        <div class="c-l">\n            <span class="btn-expression"></span>\n            <span class="btn-picture"></span>\n        </div>\n        <div class="c-m reply-textarea">\n            <textarea id="poor-text-area" placeholder="说点什么"></textarea>\n        </div>\n        <div class="c-r">\n            <span class="btn-send">发送</span>\n        </div>\n    </div>\n</script>\n\n<!-- 富文本编辑框 -->\n<script type="text/template" id="rich-text-template">\n    <div class="rich-text-back">\n        <span class="placeholder" style="display: none"></span>\n\n        <div contenteditable="true" id="rich-text-div" class="rich-text-div">\n\n        </div>\n    </div>\n</script>\n\n<!-- 公用表情表达式 -->\n<script type="text/template" id="face-expression-template">\n    <div class="face-scroller">\n        <div class="face-page">\n            <i title="微笑"></i>\n            <i title="大笑"></i>\n            <i title="眨眼"></i>\n            <i title="桃心"></i>\n            <i title="害羞"></i>\n            <i title="惊讶"></i>\n            <i title="疑问"></i>\n            <i title="天真"></i>\n            <i title="鬼脸"></i>\n            <i title="悲伤"></i>\n            <i title="白眼"></i>\n            <i title="坏笑"></i>\n            <i title="流泪"></i>\n            <i title="尴尬"></i>\n            <i title="鄙视"></i>\n            <i title="给力"></i>\n            <i title="挖鼻孔"></i>\n            <i title="晕"></i>\n            <i title="切"></i>\n            <i title="睡觉"></i>\n            <i title="鼓掌"></i>\n            <i title="嘘"></i>\n            <i title="痛恨"></i>\n            <i title="忐忑"></i>\n            <i title="失望"></i>\n            <i title="困惑"></i>\n            <i title="担心"></i>\n            <span class="btn-delete-expression"></span>\n        </div>\n        <div class="face-page">\n            <i title="纠结"></i>\n            <i title="思考"></i>\n            <i title="窃喜"></i>\n            <i title="得意"></i>\n            <i title="呆子"></i>\n            <i title="闭嘴"></i>\n            <i title="汗"></i>\n            <i title="吐"></i>\n            <i title="惊恐"></i>\n            <i title="亲亲"></i>\n            <i title="胜利"></i>\n            <i title="痛扁"></i>\n            <i title="吃饭"></i>\n            <i title="赞"></i>\n            <i title="喷血"></i>\n            <i title="再见"></i>\n            <i title="生病"></i>\n            <i title="拥抱"></i>\n            <i title="无聊"></i>\n            <i title="灵感"></i>\n            <i title="示爱"></i>\n            <i title="赞同"></i>\n            <i title="拍砖"></i>\n            <i title="囧"></i>\n            <i title="愤怒"></i>\n            <i title="抓狂"></i>\n            <i title="爱心"></i>\n            <span class="btn-delete-expression"></span>\n        </div>\n        <div class="face-page">\n            <i title="心碎"></i>\n            <i title="玫瑰"></i>\n            <i title="凋谢"></i>\n            <i title="猪头"></i>\n            <i title="菜刀"></i>\n            <i title="OK"></i>\n            <i title="Hold"></i>\n            <i title="便便"></i>\n            <i title="强"></i>\n            <i title="弱"></i>\n            <i title="看电视"></i>\n\n            <i title="骷髅"></i>\n            <i title="棒棒糖"></i>\n            <i title="萌猫"></i>\n            <i title="咖啡"></i>\n            <i title="蛋糕"></i>\n            <i title="顶"></i>\n\n            <i title="礼物"></i>\n            <i title="钱"></i>\n            <i title="天使"></i>\n            <i title="恶魔"></i>\n            <span class="place-holder-box"></span>\n            <span class="place-holder-box"></span>\n            <span class="place-holder-box"></span>\n            <span class="place-holder-box"></span>\n            <span class="place-holder-box"></span>\n            <span class="place-holder-box"></span>\n            <span class="btn-delete-expression"></span>\n        </div>\n    </div>\n    <div class="indicator">\n        <div class="dotty"></div>\n        <ul class="ind_ul">\n            <li></li>\n            <li></li>\n            <li></li>\n        </ul>\n    </div>\n</script>'),define("square/src/1.0.0/collections/topic-comment-collection",["square/src/1.0.0/models/topic-comment-model","square/src/1.0.0/content/rich-helper","square/src/1.0.0/common/util","square/src/1.0.0/common/phone-adapter"],function(a,b,c){var d=a("square/src/1.0.0/models/topic-comment-model"),e=a("square/src/1.0.0/common/util"),f=Backbone.Collection.extend({model:d,url:"",offset:0,initialize:function(a,b){this.options=this.options||{},_.extend(this.options,b)
},parse:function(a){return a},populate:function(a,b){var c=a.hasOwnProperty("data")?a.data:a;if(c){for(var f=[],g=0;g<c.length;g++){var h=new d;h.set(h.parseData(c[g])),h.set({isNewVersion:e.isNewVersion}),f.push(h)}b?this.reset(f):this.set(f,{remove:!1})}},initData:function(){this.getData({offset:0},!0)},getMoreData:function(a){a.offset=this.offset,this.getData(a)},getData:function(a,b){var c,d=this;switch(this.options.type){case e.topicType.group:c={topicId:this.options.topicId,page:a.offset+1,pagesize:20};break;case e.topicType.page:c={feedid:this.options.feedId,offset:a.offset,step:20}}$.extend(c,e.getAjaxCommonParam()),$.ajax({url:e.getUrl("topicComments",this.options.type),type:"POST",dataType:"json",data:c}).done(function(c){var e=d.parse(c);d.populate(e,b),d.offset=++a.offset}).fail(function(){seajs.log("failed to get more topic list from server")}).always(function(){a.callback&&a.callback()})}});c.exports=f}),define("square/src/1.0.0/views/topic-comment-view",["square/src/1.0.0/models/topic-comment-model","square/src/1.0.0/content/rich-helper","square/src/1.0.0/templates/templates-module","square/src/1.0.0/common/util","square/src/1.0.0/common/phone-adapter","square/src/1.0.0/views/report-topic-view","square/src/1.0.0/views/floater-view","square/src/1.0.0/collections/popup-collection"],function(a,b,c){var d=a("square/src/1.0.0/models/topic-comment-model"),e=a("square/src/1.0.0/templates/templates-module"),f=a("square/src/1.0.0/common/util"),g=a("square/src/1.0.0/views/report-topic-view"),h=a("square/src/1.0.0/views/floater-view"),i=Backbone.View.extend({tagName:"article",className:"comment",templateId:"topicCommentTpl",model:d,events:{"tap .re .show_more":"showMore","tap .re .menu .report":"report"},initialize:function(){},render:function(){var a=this;return this.$el.html(e[this.templateId].call(_,this.model.attributes)),this.floater=new h({clickHide:!0,style:{top:-100,zIndex:9999}}),this.$(".re").append(this.floater.render()),this.listenTo(this.floater,"hideFloater",function(){a.hideMore()}),this.$el},showMore:function(){this.$(".re .menu").css({zIndex:10001}).fadeIn(),this.floater.show()},hideMore:function(){this.$(".re .menu").hide(),this.floater.hideBy()},report:function(){var a=this;this.hideMore(),g.show(),g.reportOK=function(b){var c={type:b.type,reason:b.reason,elementId:a.model.get("commentId"),elementType:7},d={type:a.model.collection.type,done:function(){b.callback()},fail:function(){}};f.reportTopic(c,d)}}});c.exports=i}),define("square/src/1.0.0/views/report-topic-view",["square/src/1.0.0/templates/templates-module","square/src/1.0.0/views/floater-view","square/src/1.0.0/common/util","square/src/1.0.0/common/phone-adapter","square/src/1.0.0/collections/popup-collection"],function(a,b,c){var d=a("square/src/1.0.0/templates/templates-module"),e=a("square/src/1.0.0/views/floater-view"),f=a("square/src/1.0.0/common/util"),g=a("square/src/1.0.0/collections/popup-collection"),h=Backbone.View.extend({tagName:"div",className:"report-container share_popup",templateId:"reportTopicTpl",reportOK:function(){},events:{"tap .btn_cancel":"hideView","tap .btn_sent":"report"},initialize:function(){},render:function(){this.$el.html(d[this.templateId].call(_)),this.floater=new e({clickHide:!1,style:{opacity:.5,zIndex:9999}}),$(document.body).append(this.floater.render()),this.floater.show(),$(document.body).append(this.$el)},show:function(){var a=this,b=$(".report-container");b.length?(this.floater.show(),b.show(),this.$el.html(d[this.templateId].call(_))):this.render(),g.push({callback:function(){a.close()}})},report:function(){var a=$("input[name='reason']:checked").val();if(!a)return f.toast("请选择举报理由"),void 0;var b=$(".reason-content");return this.reportOK({type:a,reason:b.val(),callback:function(){b.val("")}}),this.hideView(),!1},hideView:function(){g.pop()},close:function(){$(".reason-content").blur();var a=this;setTimeout(function(){a.floater.hideBy(),a.$el.hide()},50)}});c.exports=new h}),define("square/src/1.0.0/views/floater-view",[],function(a,b,c){var d=Backbone.View.extend({tagName:"div",className:"page_floater",events:{tap:"hide"},initialize:function(){},render:function(){return this.$el.css(this.options.style),this.$el.width($(window).width()+200),this.$el.height($(window).height()+200),this.$el},hideBy:function(){this.$el.hide()},hide:function(){this.options.clickHide&&(this.$el.hide(),this.trigger("hideFloater"))},show:function(){this.$el.show();var a=this.options.style.opacity||0;this.$el.css({opacity:a})},remove:function(){this.$el.remove()}});c.exports=d}),define("square/src/1.0.0/collections/popup-collection",[],function(a,b,c){var d=Backbone.Collection.extend({initialize:function(){this.on("remove",this.removePopup,this)},removePopup:function(a){a.get("callback")()}});c.exports=new d}),define("square/src/1.0.0/views/share-friend-view",["square/src/1.0.0/templates/templates-module","square/src/1.0.0/common/phone-adapter","square/src/1.0.0/common/util","square/src/1.0.0/views/floater-view","square/src/1.0.0/models/topic-beside-model","square/src/1.0.0/collections/popup-collection"],function(a,b,c){var d=a("square/src/1.0.0/templates/templates-module");a("square/src/1.0.0/common/phone-adapter");var e=a("square/src/1.0.0/common/util"),f=a("square/src/1.0.0/views/floater-view"),g=a("square/src/1.0.0/models/topic-beside-model"),h=a("square/src/1.0.0/collections/popup-collection"),i=Backbone.View.extend({templateId:"shareTopicTpl",tagName:"div",className:"share_popup",initialized:!1,events:{"tap .btn_cancel":"hideView","tap .btn_sent":"shareTopic"},initialize:function(){this.model=new g,this.listenTo(this.model,"change",this.render)},render:function(){var a=this;this.$el.html(d[this.templateId].call(_,this.model.attributes)),this.initialized?(this.floater.show(),this.$el.fadeIn()):($(document.body).append(this.$el),this.floater=new f({clickHide:!1,style:{opacity:.5,zIndex:9999}}),$(document.body).append(this.floater.render()),this.floater.show(),this.initialized=!0),h.push({callback:function(){a.close()}})},hideView:function(){h.pop()},close:function(){this.$el.fadeOut(),this.floater.hideBy()},shareTopic:function(){var a=this,b={topicId:this.model.get("id"),type:this.model.get("type"),genre:this.model.get("typeId"),summary:this.$("#shareContent").val()};$.extend(b,e.getAjaxCommonParam()),this.hideView(),$.ajax({url:e.getUrl("shareTopic"),type:"post",dataType:"json",data:b}).done(function(){e.toast("已分享"),a.$("#shareContent").val("")}).fail(function(){e.toast("分享失败")})}});c.exports=new i}),define("square/src/1.0.0/views/content-view",["square/src/1.0.0/models/page-model","square/src/1.0.0/templates/templates-module","iscroll"],function(a,b,c){var d=a("square/src/1.0.0/models/page-model"),e=a("square/src/1.0.0/templates/templates-module"),f=a("iscroll"),g=Backbone.View.extend({templateId:"contentTpl",scrollerPos:{x:0,y:0},events:{},initialize:function(a){a=a?a:{},this.$el=$(a.wrapper),this.model=new d(a.model),this.overLoadHeight=a.overLoadHeight||50,this.loadMoreType=0,this.refresh=!1,this.loadMoreCallback=a.loadMoreCallback||null,_.bindAll(this,"initLoadMore","adjustFrame"),this.render()},render:function(){this.$el.html(e[this.templateId].call(_,this.model.attributes)),this.contentWrapper=this.$(".content_wrapper")},init:function(){var a={probeType:3,mouseWheel:!0,scrollbars:!0,interactiveScrollbars:!0,shrinkScrollbars:"scale",fadeScrollbars:!0};$.os.ios&&+$.os.version.split(".")[0]<6&&(a={probeType:3,mouseWheel:!0}),this.scroller=new f(this.$(".wrapper")[0],a),this.adjustFrame(),this.initLoadMore()},initLoadMore:function(){var a,b,c,d,e=this;a=function(){e.scrollTouched=!0,sendView&&sendView.hideFaceView()},b=function(){!e.refresh&&!e.scrollTouched&&this.y>0&&e.$(".load_top").animate({marginTop:-40});var a=e.offsetHeight<e.contentWrapper.height()&&this.y+e.contentWrapper.height()-e.offsetHeight;if(!e.refresh&&e.scrollTouched)if(this.y>0){if(e.$("#load_top").removeClass().addClass("touch"),this.y<e.overLoadHeight){var b=Math.ceil(this.y)-e.overLoadHeight+20;e.$(".load_top").css({marginTop:b})}this.y>e.overLoadHeight/2&&(e.$("#load_top").removeClass().addClass("start"),e.loadMoreType=0)}else 0>a&&(e.$(".load_bottom").show(),e.$("#load_bottom").removeClass().addClass("touch"),a<-e.overLoadHeight&&(e.$("#load_bottom").removeClass().addClass("start"),e.$(".load_bottom").show(),e.loadMoreType=1))},c=function(){if(!e.refresh){e.scrollTouched=!1;var a=e.scroller.y>e.overLoadHeight/2,b=e.offsetHeight<e.contentWrapper.height()&&e.scroller.y+e.contentWrapper.height()-e.offsetHeight<-e.overLoadHeight;e.refresh=a||b,a?e.$(".load_top").animate({marginTop:0}):b&&e.$(".scroller").animate({top:-40},{duration:450,complete:function(){e.$("#load_bottom").removeClass().addClass("loading")}})}},d=function(){if(e.scrollerPos={x:this.x,y:this.y},e.refresh&&e.loadMoreCallback){var a=0==e.loadMoreType?e.$("#load_top"):e.$("#load_bottom");a.removeClass().addClass("loading"),setTimeout(function(){e.loadMoreCallback({loadType:e.loadMoreType,complete:function(){e.finishLoad()}})},1e3)}},this.loadMoreCallback&&(this.scroller.on("scrollStart",a),this.scroller.on("scroll",b),this.contentWrapper.on("touchend",c),this.scroller.on("scrollEnd",d))},finishLoad:function(){console.log("load completed");var a=this;0==this.loadMoreType?(this.$(".load_top").animate({marginTop:-this.overLoadHeight},{complete:function(){a.adjustFrame()}}),this.$("#load_top").removeClass().addClass("touch")):(this.$("#load_bottom").removeClass().addClass("touch"),this.$(".scroller").animate({top:0},{complete:function(){a.adjustFrame()}})),this.refresh=!1,a.overRefresh=!1},adjustFrame:function(){this.$(".load_bottom").hide(),this.offsetHeight=this.$(".wrapper").height(),console.log("window height:"+$(window).height()),console.log(".wrapper height:"+this.offsetHeight),this.scroller.refresh()},resetScrollPos:function(a){a=a||this.scrollerPos,this.scroller.scrollTo(a.x,a.y)}});c.exports=g}),define("square/src/1.0.0/models/page-model",[],function(a,b,c){c.exports=Backbone.Model.extend({})}),define("square/src/1.0.0/views/page-view",["square/src/1.0.0/views/top-bar-view","square/src/1.0.0/templates/templates-module","square/src/1.0.0/routers/subscribe-and-publish","square/src/1.0.0/views/floater-view"],function(a,b,c){var d=a("square/src/1.0.0/views/top-bar-view"),e=a("square/src/1.0.0/templates/templates-module"),f=Backbone.View.extend({templateId:"pageTpl",initialize:function(a){a=a?a:{},this.$el=$(a.wrapper),this.topBar=new d(a.topBar),this.render()},render:function(){this.$el.html(e[this.templateId].call(_,this.model.attributes)),this.topBar.$el=this.$(".page-header"),this.topBar.render(),this.contentWrapper=this.$(".content-container")},refresh:function(){console.log("page-view refresh invoked~"),console.log(".content-container height:"+this.$(".content-container").height()),this.targetView.refresh()},minusHeight:function(a){this.$(".content-container").height(this.$(".content-container").height()-a)},hideToRight:function(){var a={props:{left:"100%"},show:!1};this.animateToggle(a)},hideToLeft:function(){var a={props:{left:"-100%"},show:!1};this.animateToggle(a)},showFromLeft:function(){var a=this,b={props:{left:0},show:!0,callback:function(){a.trigger("showFromLeft"),a.refresh()}};this.animateToggle(b)},show:function(){var a=this.$el.hasClass("animate-page")?this.$el:this.$el.parents(".animate-page");a.show()},showFromRight:function(){var a={prevProps:{left:"100%"},show:!0,props:{left:0}};this.animateToggle(a)},animateToggle:function(a){var b=this.$el.hasClass("animate-page")?this.$el:this.$el.parents(".animate-page"),c={duration:300,complete:function(){a.show?"":b.hide(),a.callback&&a.callback()}};a.prevProps&&b.css(a.prevProps),a.show?b.fadeIn():"",b.animate(a.props,c)}});c.exports=f}),define("square/src/1.0.0/views/top-bar-view",["square/src/1.0.0/templates/templates-module","square/src/1.0.0/routers/subscribe-and-publish","square/src/1.0.0/views/floater-view"],function(a,b,c){var d=a("square/src/1.0.0/templates/templates-module"),e=a("square/src/1.0.0/routers/subscribe-and-publish"),f=a("square/src/1.0.0/views/floater-view");c.exports=Backbone.View.extend({templateId:"topBarTpl",events:{"tap .h_left":"back","tap .menu_btn":"showMenu","tap .top_menu":"clickItem","tap .title":"resize"},resize:function(){$(window).resize()},initialize:function(){},render:function(){var a=this,b={};switch(b.title=this.options.title||"",b.menuItems=this.options.menuItems||[],b.menuBtnType=this.options.menuBtnType||0,+this.options.menuBtnType){case 0:b.menuClass="",this.$el.html(d[this.templateId].call(_,b));break;case 1:b.menuClass="btn_msg",this.$el.html(d[this.templateId].call(_,b));break;case 2:b.menuClass="btn_more",this.$el.html(d[this.templateId].call(_,b)),this.floater=new f({clickHide:!0,style:{top:-100,zIndex:9999}}),this.$el.append(this.floater.render()),this.listenTo(this.floater,"hideFloater",function(){a.hideMenu()})}this.delegateEvents()},showMenu:function(){var a=this.options.menuCallback;return a?a():(this.$(".top_menu").show(),this.floater.show()),!1},hideMenu:function(){this.$(".top_menu").hide()},clickItem:function(a){a=a||window.event;var b=$(a.target||a.srcElement);b=b.is("span")?b.parent():b;var c=b.attr("data-action");e.publish("topBar_"+c),this.floater.hide()},back:function(){return e.publish("NAV_BACK"),this.trigger("NAV_BACK"),!1}})}),define("square/src/1.0.0/views/message-view",["square/src/1.0.0/templates/templates-module","square/src/1.0.0/common/phone-adapter"],function(a,b,c){var d=a("square/src/1.0.0/templates/templates-module"),e=a("square/src/1.0.0/common/phone-adapter"),f=Backbone.View.extend({templateId:"messageTpl",events:{},initialize:function(){},render:function(){this.$el.html(d[this.templateId].call(_)),e.clearMessageState()}});c.exports=new f}),define("square/src/1.0.0/content/send-view",["square/src/1.0.0/common/util","square/src/1.0.0/common/phone-adapter","square/src/1.0.0/content/rich-text-view","square/src/1.0.0/content/rich-helper","square/src/1.0.0/templates/templates-module","square/src/1.0.0/views/floater-view","square/src/1.0.0/collections/popup-collection","square/src/1.0.0/content/face-expression-view","iscroll"],function(a,b,c){var d=a("square/src/1.0.0/common/util"),e=a("square/src/1.0.0/content/rich-text-view"),f=a("square/src/1.0.0/templates/templates-module"),g=a("square/src/1.0.0/views/floater-view"),h=a("square/src/1.0.0/collections/popup-collection"),i=Backbone.View.extend({templateAloneId:"common-content-alone-template",tagName:"div",className:"bottom-comment",broadcastDiv:"",plugin:{},maxCount:400,placeHolder:"",initinalized:!1,regEvents:{},events:{"tap #btn-test":"test","tap .btn-expression":"toggleFaceView","tap .textarea":"hideFaceView","tap .btn-send":"sendComment","tap .btn-delete-expression":"deleteExpression"},test:function(){alert()},initialize:function(){_.bindAll(this,"show","hide","toggleFaceView","validateContent")},render:function(){var a=this;a.initinalized=!0,a.$el.html(f[a.templateAloneId].call(_)),this.$body=$(document.body),this.delegateEvents(),this.plugin.richTextView=new e,this.plugin.richTextView.render(this.$el.find(".reply-textarea")),this.plugin.richTextView.registerEvents({validate:function(){a.validateContent()}}),this.$shareCheckbox=this.$el.find("#chkShare"),this.$bottomComment=this.$el.find(".bottom-comment"),this.$body.append(this.$el),this.floater=new g({clickHide:!0,style:{opacity:.5,zIndex:9997}}),this.listenTo(this.floater,"hideFloater",function(){a.hideView()}),this.$body.append(this.floater.render())},registerEvents:function(a){this.regEvents=a},show:function(a){buriedPoint(36008005),0===$(document.body).find(".bottom-comment").length&&this.render(),a=a?a:"";var b=a?'<span id="replyTo"><button onclick="return false;" tabindex="-1" contenteditable="false" class="input-button">'+a+"：</button></span>":"";return this.plugin.richTextView.model.clear({silent:!0}),this.plugin.richTextView.model.set("placeholder",a?a:"我也说一句"),this.plugin.richTextView.model.set("preContent",b),this.delegateEvents(),!1},hide:function(){seajs.log("hideSendView"),this.$el.removeClass("active"),this.plugin.richTextView&&this.plugin.richTextView.resetFocus(),this.plugin.faceView&&this.plugin.faceView.hideExpressionPanel()},hideFaceView:function(){this.plugin.faceView&&this.plugin.faceView.hideExpressionPanel(),this.plugin.richTextView&&this.plugin.richTextView.blur()},toggleFaceView:function(){var b=this,c=this.plugin.faceView;return c||(c=this.plugin.faceView=a("square/src/1.0.0/content/face-expression-view")),c.parentDiv=this.$el,c.registerEvents({pickExpression:function(a){b.plugin.richTextView.insertEl(a.el)}}),c.toggleExpressionPanel(),!1},deleteExpression:function(){this.plugin.richTextView.deleteEl()},sendComment:function(){var a=this.plugin.richTextView.getContent();return a.length?(this.hideView(),this.regEvents.sendComment({content:a,isToFeed:this.getShareCheckboxValue()||0}),!1):(d.toast("请输入评论内容"),void 0)},validateContent:function(){var a=this.plugin.richTextView.getContent();a?this.$(".send-comment-button").removeClass("grey").removeAttr("disabled"):this.$(".send-comment-button").addClass("grey").attr("disabled","disabled")},showBottomComment:function(){var a=this;this.floater&&this.floater.show(),this.$el&&(this.$el.addClass("active"),h.push({callback:function(){a.floater.hideBy(),a.hideBottomComment(),a.reset()}})),this.plugin.richTextView&&this.plugin.richTextView.focus()},hideBottomComment:function(){this.$el&&(this.$el.removeClass("active"),h.pop())},hideFloater:function(){this.floater.hide()},resetShareCheckbox:function(){this.$shareCheckbox&&this.$shareCheckbox.prop("checked",!1)},getShareCheckboxValue:function(){if(this.$shareCheckbox)return Number(this.$shareCheckbox.prop("checked"));throw new Error("can not find share checkbox.")},reset:function(){this.resetShareCheckbox(),this.hideFaceView(),this.plugin.richTextView.reset()},hideView:function(){h.pop()}});c.exports=new i}),define("square/src/1.0.0/content/rich-text-view",["square/src/1.0.0/content/rich-helper","square/src/1.0.0/templates/templates-module"],function(a,b,c){var d=a("square/src/1.0.0/content/rich-helper"),e=a("square/src/1.0.0/templates/templates-module"),f=Backbone.View.extend({templateId:"rich-text-template",tagName:"div",className:"textarea",maxCount:400,focusNode:null,focusOffset:0,regEvents:{},scroll:0,events:{"click .placeholder":"focus","keyup #rich-text-div":"validateContent","mouseup #rich-text-div":"validateContent","paste #rich-text-div":"pasteHtml"},initialize:function(){this.model=new Backbone.Model({placeholder:this.placeHolder,preContent:this.preContent}),this.model.on("change:preContent",function(){seajs.log("rich-text-model changed~~~"),this.resetFocus(),this.$el.find("#rich-text-div").html("");var a=arguments[1];a?this.insertEl(a):""},this),this.model.on("change:placeholder",function(){this.$el.find(".placeholder").text(arguments[1]),this.$el.find(".placeholder").show()},this)},reset:function(){var a=_.clone(this.model.attributes);this.model.clear(),this.model.set(a)},render:function(a){this.$el.html(e[this.templateId].call(_)),a.append(this.$el),this.delegateEvents()},registerEvents:function(a){this.regEvents=a},getContent:function(){return this.filterContent()},getHtml:function(){return this.scroll=this.$("#rich-text-div")[0].scrollTop,this.$("#rich-text-div").html()},getUsefulHtml:function(){return this.getContent().length?this.getHtml():""},pasteHtml:function(){var a=this;setTimeout(function(){var b=a.$("#rich-text-div").html();a.$("#rich-text-div").html(""),b=$("<i/>"+b+"<i/>");var c=a.filterPaste(b);a.insertEl(c+"&nbsp;",!0),a.model.get("preContent")&&a.$("#rich-text-div").prepend(a.model.get("preContent"))},0)},filterPaste:function(a){var b=this,c="";return a.each(function(a,e){var f=$(e);if("replyTo"==f.attr("id"))return!0;if(f.is("img")&&f.hasClass("face-size"))c+=f.prop("outerHTML");else if(f.is("br"))c+="<br/>";else{if(f.is("i"))return!0;c+=f.is("div")?"<br/>"+b.filterPaste($("<i/>"+f.html()+"<i/>")):d.filterEnter(f.text())}}),c},filterContent:function(){var a=this.getHtml(),b="",c=!1;if(a.length){a=$("<i/>"+a+"<i/>");var d=this.getRichText(a);c=d.isReply,b=d.content}return b.length||c?this.$el.find(".placeholder").hide():this.$el.find(".placeholder").show(),$.trim(b)},getRichText:function(a){var b=this,c=$("<textarea>"),d=!1;return a.each(function(e,f){var g=$(f);if("replyTo"==g.attr("id"))return d=!0,!0;if(g.is("img"))c.val(c.val()+"[/"+g.attr("title")+"]");else if(g.is("br"))c.val(c.val()+"\r\n");else{if(g.is("i"))return!0;if(g.is("div")){var h="";g.children().length&&!g.find(":first-child").is("br")&&(g.children().length>1&&g.find(":last-child").is("br")&&g.find(":last-child").remove(),h="\r\n"),g.children().length||(h="\r\n"),h+=b.getRichText($("<i/>"+g.html()+"<i/>")).content,c.val(c.val()+h)}else c.val(c.val()+a[e].textContent)}}),{isReply:d,content:c.val()}},validateContent:function(){this.setFocus();var a=this.getContent();this.regEvents.validate&&this.regEvents.validate(a.length)},resetFocus:function(){this.setFocus({node:this.$el.find("#rich-text-div")[0],offset:0})},setFocus:function(a){var b=window.getSelection();this.focusNode=a?a.node:b.anchorNode,this.focusOffset=a?a.offset:b.focusOffset},focus:function(){this.$el.find("#rich-text-div").focus()},blur:function(){this.$el.find("#rich-text-div").blur()},keyDown:function(a){switch(a.keyCode){case 8:if("replyTo"==this.focusNode.id)return a.returnValue=!1,!1;break;case 46:if("rich-text-div"==this.focusNode.id&&0==this.focusOffset)return a.returnValue=!1,!1}this.validateContent()},insertEl:function(a,b){var c=this.$el.find("#rich-text-div"),d=c.find("#other");if(d&&d.remove(),a){var e=window.getSelection();if(e.rangeCount&&"rich-text-div"===e.anchorNode.id){var f=e.getRangeAt(0);f.collapse(!1);try{b||(f.setStart(this.focusNode,this.focusOffset),f.setEnd(this.focusNode,this.focusOffset))}catch(g){console.log(g)}var h=f.createContextualFragment(a),i=h.lastChild;f.insertNode(h),i&&(f.setEndAfter(i),f.setStartAfter(i)),e.removeAllRanges(),e.addRange(f),c.blur()}else c.append(a);this.scroll&&c.scrollTop(this.scroll),this.validateContent()}},deleteEl:function(){var a,b,c=this.$el.find("#rich-text-div"),d=c.children("img[title]"),e=window.getSelection(),f=e.type;if(""!==$.trim(c.html()))if("None"===f)a=_.last(d),a&&a.remove();else if("Range"===f)b=e.getRangeAt(),b&&b.deleteContents();else if("Caret"===f){b=document.createRange();try{b.setStart(e.anchorNode,e.anchorOffset-1),b.setEnd(e.focusNode,e.focusOffset),b.deleteContents(),"undefined"!=typeof e.anchorNode.id&&e.collapse(this.anchorNode,this.focusOffset-1)}catch(g){console.log(g)}}}});c.exports=f}),define("square/src/1.0.0/content/face-expression-view",["square/src/1.0.0/content/rich-helper","square/src/1.0.0/templates/templates-module","iscroll"],function(a,b,c){var d=a("square/src/1.0.0/content/rich-helper"),e=a("square/src/1.0.0/templates/templates-module"),f=a("iscroll"),g=Backbone.View.extend({tagName:"div",id:"common-expression-panel",className:"facePanel",templateId:"face-expression-template",parentDiv:"",regEvents:{},events:{"tap i":"clickExpression"},initialize:function(){_.bindAll(this,"render","toggleExpressionPanel","hideExpressionPanel")},render:function(){if(""==this.$el.html()){this.$el.html(e[this.templateId].call(_));var a=Math.floor(4*($(window).width()/7));this.$(".face-scroller").height(a),this.$el.height(a-13),this.scroller=new f(this.$el[0],{scrollX:!0,scrollY:!1,momentum:!1,snap:!0,snapSpeed:400,indicators:{el:this.$(".indicator")[0],resize:!1}})}this.parentDiv.append(this.$el),this.delegateEvents()},toggleExpressionPanel:function(){if(0==this.parentDiv.find("#common-expression-panel").length)this.render(),this.scroller.refresh();else{var a=$("#common-expression-panel").is(":visible");this.showExpressionPanel(!a)}},showExpressionPanel:function(a){a?(this.$el.show(),this.scroller.refresh()):this.$el.hide()},hideExpressionPanel:function(){this.showExpressionPanel(!1),this.scroller.scrollTo(0,0)},display:function(){return $("#common-expression-panel").is(":visible")},registerEvents:function(a){this.regEvents=a},clickExpression:function(a){var b=a.target;if(!$(a.target).hasClass("delete-expression")&&!$(a.target).hasClass("unselect")){var c=$(b).attr("title"),e="[/"+c+"]",f=d.filterContentExpression(e);this.regEvents.pickExpression({el:f})}},changeExpressionPanel:function(a){var b=$(a.target),c=this;b.hasClass("index1")?c.$("#expression-slider").css("left","-252px"):c.$("#expression-slider").css("left","0px")}});c.exports=new g}),define("square/src/1.0.0/views/app",["square/src/1.0.0/common/util","square/src/1.0.0/common/phone-adapter","square/src/1.0.0/views/navi-view","square/src/1.0.0/templates/templates-module","iscroll","square/src/1.0.0/models/navi-model","square/src/1.0.0/controls/topic-manager","square/src/1.0.0/views/topic-view","square/src/1.0.0/collections/topic-collection","square/src/1.0.0/models/topic-beside-model","square/src/1.0.0/views/slide-view","square/src/1.0.0/models/slide-model","localdb","square/src/1.0.0/views/content-view","square/src/1.0.0/models/page-model"],function(a,b,c){var d=a("square/src/1.0.0/common/util"),e=a("square/src/1.0.0/views/navi-view"),f=a("square/src/1.0.0/models/navi-model"),g=a("square/src/1.0.0/controls/topic-manager"),h=a("localdb"),i=Backbone.View.extend({el:"",catalog:{},page:null,events:{"swipe .content_wrapper .catalog":"changeTab"},initialize:function(){},render:function(){},refresh:function(){this.currentTopicManager?this.currentTopicManager.refresh():""},initDataFromServer:function(){this.listenTo(this.page,"showFromLeft",function(){$(window).resize(),e.scroller.refresh()}),this.initCatalog()},initCatalog:function(){console.log("initCatalog~");var a=this,b=function(b){e.initialized?e.model.set(b):(e.model=new f({items:b}),a.page.contentWrapper.prepend(e.render()),console.log("listen tabChanged changed~"),a.listenTo(e,"tabChanged",a.showTopicList)),console.log("naviView.initScroller~"),e.initScroller(),console.log("self.showTopicList~"),a.showTopicList()},c={},g="square_catalog",i=h.get(g);i&&b(i),$.extend(c,d.getAjaxCommonParam()),$.ajax({url:d.getUrl("loadCatalog"),type:"POST",dataType:"json",data:c}).done(function(a){h.set(g,a),i||b(a)}).fail(function(a,b,c){console.log("API FAIL. "+c)})},showTopicList:function(){var a=e.getCurrentTab(),b=e.prevTab;if(b){var c=this.catalog[b.id];c.hide()}var d=this.catalog[a.id];d?d.show():(d=new g({dataId:a.id,dataType:a.type}),this.catalog[a.id]=d,this.page.contentWrapper.append(d.render())),this.currentTopicManager=d,$(window).resize()}});c.exports=i}),define("square/src/1.0.0/views/navi-view",["square/src/1.0.0/templates/templates-module","iscroll"],function(a,b,c){var d=a("square/src/1.0.0/templates/templates-module");a("iscroll");var e=Backbone.View.extend({templateId:"navTpl",tagName:"nav",prevTab:null,initialized:!1,events:{"tap .catalog li":"changeTab"},initialize:function(){_.bindAll(this,"adjustFrame"),$(window).resize(this.adjustFrame)},render:function(){return this.$el.html(d[this.templateId].call(_,this.model.attributes)),this.initialized||this.listenTo(this.model,"change",this.render),this.initialized=!0,this.$el},adjustFrame:function(){this.$el.width($(window).width())},changeTab:function(a){a=a||window.event;var b=$(a.target||a.srcElement);b=b.is("li")?b:b.parent(),b.hasClass("active")||(console.log("changeTab"),this.prevTab=this.getCurrentTab(),$(".catalog li.active").removeClass("active"),b.addClass("active"),this.trigger("tabChanged"))},getCurrentTab:function(){var a=$(".catalog li.active"),b=a.attr("data-id"),c=a.attr("data-type");return{id:b,type:c}},initScroller:function(){}});c.exports=new e}),define("square/src/1.0.0/models/navi-model",[],function(a,b,c){var d=Backbone.Model.extend({defaults:{items:[{id:"1",TypeName:"最热门",Type:"9999"}]},parse:function(){var a=this.get("items");for(var b in a)console.log(a[b])}});c.exports=d}),define("square/src/1.0.0/controls/topic-manager",["square/src/1.0.0/common/util","square/src/1.0.0/common/phone-adapter","square/src/1.0.0/views/topic-view","square/src/1.0.0/templates/templates-module","square/src/1.0.0/collections/topic-collection","square/src/1.0.0/models/topic-beside-model","square/src/1.0.0/views/slide-view","iscroll","square/src/1.0.0/models/slide-model","localdb","square/src/1.0.0/views/content-view","square/src/1.0.0/models/page-model"],function(a,b,c){var d=a("square/src/1.0.0/common/util"),e=a("square/src/1.0.0/views/topic-view"),f=a("square/src/1.0.0/collections/topic-collection"),g=a("square/src/1.0.0/templates/templates-module"),h=a("square/src/1.0.0/views/slide-view"),i=a("localdb"),j=a("square/src/1.0.0/views/content-view"),k=Backbone.View.extend({tagName:"div",templateId:"tabContentTpl",className:"nav-tab-content",attributes:function(){var a="topic_container_"+this.options.dataId;return{id:a}},initialize:function(a){_.bindAll(this,"addOne","addAll","loadMoreTopics");var b=new f;b.typeId=a.dataType,b.offset={group:0,page:0},this.listenTo(b,"add",this.addOne),this.listenTo(b,"reset",this.addAll),this.collection=b},render:function(){var a=new j({wrapper:this.$el,loadMoreCallback:this.loadMoreTopics});return this.wrapper=a.contentWrapper,this.contentView=a,this.wrapper.html(g[this.templateId].call(_)),this.initData({refresh:!1}),a.init(),this.$el},addOne:function(a){var b=new e({model:a});this.$(".topic_container").append(b.render())},addAll:function(){console.log("reset topic list"),this.$(".topic_container").html(""),this.collection.length&&this.collection.each(this.addOne),$(window).resize()},renderSlider:function(a){if(this.imageSlider)this.imageSlider.initImgData(a);else{var b=new h({items:a,type:this.options.dataType});b.$el=this.$(".slider"),b.render(),this.imageSlider=b}},initData:function(a){var b=this,c={typeId:b.options.dataType},e="topicList_"+b.options.dataType,f=function(c){b.renderSlider(c.images),b.collection.initData(c.list),a&&a.callback&&a.callback()};try{var g=i.get(e)}catch(h){d.toast("无法从本地获取数据")}g&&g.list&&g.list.length&&!a.refresh?f(g):($.extend(c,d.getAjaxCommonParam()),$.ajax({url:d.getUrl("topTopic"),data:c,type:"POST",dataType:"json"}).done(function(a){if(a&&a.list&&a.list.length){f(a);try{i.set(e,a)}catch(b){d.toast("无法缓存数据到本地")}}else d.toast("加载失败，请稍后再试")}).fail(function(){d.toast("加载失败，请稍后再试")}))},loadMoreTopics:function(a){console.log("刷新回调:"+a.loadType);var b={callback:a.complete};a.loadType?this.collection.getMoreData(b):(b.refresh=!0,this.initData(b))},hide:function(){this.$el.hide()},show:function(){this.$el.fadeIn()},refresh:function(){console.log("topicManager refresh~"),this.imageSlider&&this.imageSlider.scroller&&this.imageSlider.scroller.refresh(),this.contentView.adjustFrame(),this.contentView.resetScrollPos()}});c.exports=k}),define("square/src/1.0.0/views/topic-view",["square/src/1.0.0/templates/templates-module"],function(a,b,c){var d=a("square/src/1.0.0/templates/templates-module");c.exports=Backbone.View.extend({templateId:"topicTpl",attributes:function(){return{"data-id":this.model.get("id")}},tagName:"article",className:"topic",events:{tap:"dumpToDetailPage"},initialize:function(){},render:function(){return this.$el.html(d[this.templateId].call(_,this.model.toJSON())),this.$el},dumpToDetailPage:function(){console.log("跳转到详情页!");var a=+this.model.get("browsers");this.model.set("browsers",a+1),squareApp.navigate("/topicDetail/"+this.model.get("type")+"/"+this.model.get("id"),{trigger:!0})}})}),define("square/src/1.0.0/collections/topic-collection",["square/src/1.0.0/models/topic-beside-model","square/src/1.0.0/common/util","square/src/1.0.0/common/phone-adapter"],function(a,b,c){var d=a("square/src/1.0.0/models/topic-beside-model"),e=a("square/src/1.0.0/common/util"),f=Backbone.Collection.extend({model:d,url:"",initialize:function(){},parse:function(a){return a},populate:function(a,b){var c=a;if(c){for(var f=[],g=0;g<c.length;g++){var h=new d;switch(h.set(h.parseData(c[g])),h.set({topicId:this.topicId}),f.push(h),h.get("type")){case e.topicType.group:this.offset.group=h.get("id");
break;case e.topicType.page:this.offset.page=h.get("id")}}b?this.reset(f):this.set(f,{remove:!1})}},initData:function(a){this.populate(a,!0)},getMoreData:function(a){var b=this,c={typeId:this.typeId,topicid:this.offset.group,elementid:this.offset.page,pagesize:20,logic:!0};$.extend(c,e.getAjaxCommonParam()),$.ajax({url:e.getUrl("topicList"),type:"POST",dataType:"json",data:c}).done(function(a){var c=b.parse(a);b.populate(c)}).fail(function(){seajs.log("failed to get more topic list from server")}).always(function(){a.callback&&a.callback()})}});c.exports=f}),define("square/src/1.0.0/views/slide-view",["square/src/1.0.0/templates/templates-module","iscroll","square/src/1.0.0/common/phone-adapter","square/src/1.0.0/models/slide-model"],function(a,b,c){var d=a("square/src/1.0.0/templates/templates-module"),e=a("iscroll"),f=a("square/src/1.0.0/common/phone-adapter"),g=a("square/src/1.0.0/models/slide-model"),h=Backbone.View.extend({templateId:"slideTpl",events:{"tap .slide":"enterHotBlock"},initialize:function(a){this.initialized=!1,this.initImgData(a.items),this.listenTo(this.model,"change",this.render)},initImgData:function(a){var b=this.model?this.model:new g;b.set({items:b.populate(a)}),this.model=b},render:function(){this.$el.html(d[this.templateId].call(_,this.model.attributes)),this.initialized?this.scroller?this.scroller.refresh():null:(this.model.get("items").length>1&&this.loadedImage(),this.initialized=!0),this.delegateEvents()},loadedImage:function(){this.scroller=new e(this.$(".imageWrapper")[0],{scrollX:!0,scrollY:!1,momentum:!1,snap:!0,snapSpeed:400,indicators:{el:this.$(".indicator")[0],resize:!1}})},enterHotBlock:function(a){var b=$(a.target);b=b.is("img")||b.hasClass("content")?b.parent():b;var c=this.model.get("items")[b.index()];switch(transAndPoint(this.options.type,b.index()),+c.type){case 0:f.openUrl(c);break;case 1:squareApp.navigate("/topicDetail/1/"+c.url,{trigger:!0});break;case 2:squareApp.navigate("/topicDetail/2/"+c.url,{trigger:!0})}return!1}});c.exports=h}),define("square/src/1.0.0/models/slide-model",[],function(a,b,c){var d=Backbone.Model.extend({defaults:{items:[{id:0,title:"",summary:"",url:"",img:"http://imgl.1.png",type:0}]},populate:function(a){var b=this,c=[];return _.each(a,function(a){c.push(b.parseData(a))}),c},parseData:function(a){var b={id:a.id||0,title:a.Title||"",summary:a.Summary||"",url:a.URL||"",img:a.Img||"http://imgl.1.png",type:a.Type||0};return b}});c.exports=d});
